<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Timezones</title>
  </head>
  <body>
    Timezones

    <div id="googleMap" style="width: 100%; height: 400px"></div>

    <div id="demo">Test</div>
  </body>
  <script>
    var mapProp, map;

    function myMap() {
      mapProp = {
        center: new google.maps.LatLng(51.508742, -0.12085),
        zoom: 7,
      };
      map = new google.maps.Map(document.getElementById("googleMap"), mapProp);
      getLocation();

      google.maps.event.addListener(map, "click", function (event) {
        console.log(event);

        fetch(
          // `https://maps.googleapis.com/maps/api/timezone/json?location=38.908133,-77.047119&timestamp=1458000000&key=AIzaSyAxtd2uJWYRCK-Mm8lcJyoBKq7E5s1chZs`
          // `https://api.askgeo.com/v1/2277/98f5c4ddbc1e68545f62aaaba786c6e9f8e37a11b74c5b5734228149aaa5f73f/query.json?points=37.78%2C-122.42%3B40.71%2C-74.01&databases=Point%2CTimeZone%2CAstronomy%2CNaturalEarthCountry%2CUsState2010%2CUsCounty2010%2CUsCountySubdivision2010%2CUsTract2010%2CUsBlockGroup2010%2CUsPlace2010%2CUsZcta2010`
          `https://api.teleport.org/api/locations/59.4372,24.7453/?embed=location:nearest-cities/location:nearest-city/city:timezone/tz:offsets-now%20|%20jq%20%27._embedded.%22location:nearest-cities%22[0]._embedded.%22location:nearest-city%22._embedded.%22city:timezone%22%27`
        )
          .then(function (response) {
            // The response is a Response instance.
            // You parse the data into a useable format using `.json()`
            return response.json();
          })
          .then(function (data) {
            console.log(
              data._embedded["location:nearest-cities"][0]._embedded[
                "location:nearest-city"
              ]._embedded["city:timezone"].iana_name
            );
          });

        console.log(event.latLng.lat());
        console.log(event.latLng.lng());
      });
      google.maps.event.addListener(map, "touchstart", function (event) {
        console.log(event);
        console.log("fetch attempt...");
        fetch(
          `https://api.teleport.org/api/locations/59.4372,24.7453/?embed=location:nearest-cities/location:nearest-city/city:timezone/tz:offsets-now%20|%20jq%20%27._embedded.%22location:nearest-cities%22[0]._embedded.%22location:nearest-city%22._embedded.%22city:timezone%22%27`
        )
          .then(function (response) {
            return response.json();
          })
          .then(function (data) {
            console.log(
              data._embedded["location:nearest-cities"][0]._embedded[
                "location:nearest-city"
              ]._embedded["city:timezone"].iana_name
            );
          });
        // fetch(
        //   `https://api.teleport.org/api/locations/${event.latLng.lat()},${event.latLng.lng()}/?embed=location:nearest-cities/location:nearest-city/city:timezone/tz:offsets-now%20|%20jq%20%27._embedded.%22location:nearest-cities%22[0]._embedded.%22location:nearest-city%22._embedded.%22city:timezone%22%27`
        // )
        //   .then((res) => {
        //     // console.log(res);
        //     res.json();
        //   })
        //   .then((data) => {
        //     console.log(data);
        //   });
        console.log(event.latLng.lat());
        console.log(event.latLng.lng());
        // marker = new google.maps.Marker({position: event.latLng, map: map});
      });
    }

    var x = document.getElementById("demo");
    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);
      } else {
        x.innerHTML = "Geolocation is not supported by this browser.";
      }
    }

    function showPosition(position) {
      x.innerHTML =
        "Latitude: " +
        position.coords.latitude +
        "<br>Longitude: " +
        position.coords.longitude;

      console.log(map);
      map.setCenter(
        new google.maps.LatLng(
          position.coords.latitude,
          position.coords.longitude
        )
      );
    }

    // Function for adding a marker to the page.
    function addMarker(location) {
      marker = new google.maps.Marker({
        position: location,
        map: map,
      });
    }

    // Testing the addMarker function
    function TestMarker() {
      CentralPark = new google.maps.LatLng(37.7699298, -122.4469157);
      addMarker(CentralPark);
    }

    var d = new Date();
    var n = d.getTime();

    console.log(n);
  </script>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAxtd2uJWYRCK-Mm8lcJyoBKq7E5s1chZs&callback=myMap"></script>
  <script src="./index.js"></script>
</html>
